{% extends "projects/base.html" %}
{% load i18n %}
{% load markup %}
{% load tx-common %}
{% load statistics %}

{% block body_class %}{{ block.super }} project_detail{% endblock %}

{% block title %}{{ block.super }} | {{ project.name }}{% endblock %}

{% block extra_head %}
  <link rel="alternate" type="application/rss+xml" title="RSS" href="{% url project_feed param=project.slug %}" />
{% endblock %}

{% block breadcrumb %}{{ block.super }} &raquo; {{ project.name }}{% endblock %}

{% block body_sec %}
  <a class="simlink" href="{% url project_feed param=project.slug %}" title="Project feed"><img border="0" src="{{ MEDIA_URL }}images/icons/feed.png" /></a>
{% endblock %}

{% block body_main %}
  <div class="obj_bigdetails">
  <h2 class="name">{{ project.name }}</h2>

  {% if request.user.is_authenticated and perms.projects.change_project %}
  <div class="editlinks"><p class="i16 edit"><a href="{% url project_edit project_slug=project.slug %}">{% trans "Edit" %}</a></p></div>
  {% endif %}
  
  <p class="description">{% firstof project.description project.name %}</p>

  {% with project.long_description_html as long_desc %}
  {% if long_desc %}
  <div class="long_description">
    {{ long_desc|truncatewords_html:"100"|safe }}
  </div>
  {% endif %}
  {% endwith %}

  <div class="details separate">

  {% if project.homepage or project.tags or project.collections.all %}
    <h4>{% blocktrans %}Details{% endblocktrans %}</h4>
  {% endif %}
  <table class="definition">
    {% if project.homepage %}
    <tr>
      <th class="homepage i16">{% trans "Homepage:" %}</th>
      <td><a title="{% blocktrans with project.name as project_name %}Homepage for {{ project_name }}{% endblocktrans %}" href="{{ project.homepage }}" target="_blank" >{{ project.homepage }}</a></td>
    </tr>
    {% endif %}
    {% if project.tags %}
    <tr>
      <th class="i16 tag">{% trans "Tags:" %}</th>
      <td class="compact">
        {% for tag in project.tagsobj.all|slice:"0:6" %}<a class="tag" href="{% url project_tag_list tag=tag %}">{{ tag }}</a> {% endfor %}
      </td>
    </tr>
    {% endif %}
    {% with project.collections.all as colls %}
    {% if colls %}
    <tr>
      <th class="i16 collection">{% blocktrans count colls|length as counter %}Collection:{% plural %}Collections:{% endblocktrans %}</th>
      <td class="compact">
        {% for coll in colls|slice:"0:6" %}<a class="collection" href="{% url collection_detail slug=coll.slug %}">{{ coll }}</a> {% endfor %}
      </td>
    </tr>
    {% endif %}
    {% endwith %}
    {% with project.maintainers.all as maintainers %}
    {% if maintainers %}
    <tr>
      <th class="i16 maintainer">{% blocktrans count maintainers|length as counter %}Maintainer:{% plural %}Maintainers:{% endblocktrans %}</th>
      <td>
        {% for m in maintainers|slice:"0:6" %}
          {% if m.first_name and m.last_name %}
            {{ m.first_name }} {{ m.last_name }} ({{m.email|mungify:m.username}})
          {% else %}
            {{m.email|mungify:m.username}}{% endif %}{% if not forloop.last %},{% endif %}
        {% endfor %}
      </td>
    </tr>
    {% endif %}
    {% endwith %}
{% comment %}
    <tr>
      <th class="i16 link">{% trans "External links:" %}</th>
      <td><ul>
        <li>{% trans "Screenshots" %}</li>
        </ul>
      </td>
    </tr>
{% endcomment %}
  </table>
</div>

{% include "projects/component_list.html" %}

</div>

<h3>{% trans 'History' %}</h3>
{% load tx_action_log %}
{% get_log 5 as action_log for_object project %}
{% if not action_log %}
<p>{% trans 'None available' %}</p>
{% else %}
<ul class="actionlist simple">
{% for entry in action_log %}
<li class="i16 {% if entry.is_addition %}add{% endif %}{% if entry.is_change %}change{% endif %}{% if entry.is_deletion %}delete{% endif %}">
    Project {% if entry.is_addition %}added{% endif %}{% if entry.is_change %}modified{% endif %}{% if entry.is_deletion %}deleted{% endif %} by {{ entry.user }} on 
    {{ entry.action_time|date:"r" }}
{% endfor %}
</ul>
{% endif %}

{% endblock %}

{% block content_footer %}
  <div id="content_footer_center">
    {% if request.user.is_authenticated and perms.projects.delete_project %}
    <div class="deletelink">
      <span class="i16 delete"><a href="{% url project_delete project_slug=project.slug %}">{% trans "Delete project" %}</a></span>
    </div>
    {% endif %}
  </div>
{% endblock %}
